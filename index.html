<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  let gameRunning = false;
  const ninjaSprite = new Image();
  ninjaSprite.src = "f2dda6643a72eebaf2956c3e925267b8.jpg"; // Local sprite path or upload it to an image host and use the direct URL

  let ninja = {
    x: 40,
    y: 300,
    side: 'left',
    width: 48,
    height: 48,
    frameX: 0,
    frameY: 0,
    frameCount: 6,
    tick: 0,
    tickLimit: 8
  };

  let gravity = 2;
  let score = 0;
  let shurikens = [];

  function drawNinja() {
    if (ninjaSprite.complete) {
      ctx.drawImage(
        ninjaSprite,
        ninja.frameX * ninja.width, ninja.frameY * ninja.height,  // Source x, y
        ninja.width, ninja.height,  // Source width, height
        ninja.x, ninja.y,           // Canvas position
        ninja.width, ninja.height   // Size on canvas
      );
    }
  }

  function updateNinjaFrame() {
    ninja.tick++;
    if (ninja.tick >= ninja.tickLimit) {
      ninja.frameX = (ninja.frameX + 1) % ninja.frameCount;
      ninja.tick = 0;
    }
  }

  function startGame() {
    document.getElementById("home").style.display = "none";
    canvas.style.display = "block";
    gameRunning = true;
    score = 0;
    ninja.y = 300;
    ninja.side = 'left';
    ninja.x = 40;
    ninja.frameX = 0;
    shurikens = [];
    requestAnimationFrame(loop);
  }

  function loop() {
    if (!gameRunning) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#f2c94c';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    updateNinjaFrame();
    drawNinja();

    ninja.y += gravity;

    for (let i = 0; i < shurikens.length; i++) {
      let s = shurikens[i];
      s.y += s.speed;
      ctx.fillStyle = 'black';
      ctx.beginPath();
      ctx.arc(s.x, s.y, 5, 0, Math.PI * 2);
      ctx.fill();

      if (
        s.x > ninja.x && s.x < ninja.x + ninja.width &&
        s.y > ninja.y && s.y < ninja.y + ninja.height
      ) {
        gameRunning = false;
        setTimeout(() => {
          alert("Game Over! Your score: " + score);
          location.reload();
        }, 100);
      }
    }

    if (Math.random() < 0.02) {
      shurikens.push({ x: Math.random() * canvas.width, y: 0, speed: 4 + Math.random() * 4 });
    }

    score++;
    ctx.fillStyle = 'black';
    ctx.font = '20px Arial';
    ctx.fillText('Score: ' + score, 10, 30);

    requestAnimationFrame(loop);
  }

  canvas.addEventListener("click", () => {
    if (!gameRunning) return;
    ninja.side = ninja.side === 'left' ? 'right' : 'left';
    ninja.x = ninja.side === 'left' ? 40 : canvas.width - 70;
    ninja.y -= 50;
  });

  document.getElementById("startBtn").addEventListener("click", startGame);
</script>
